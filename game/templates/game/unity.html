{% extends "game/playerbase.html" %}

{% block content %}
<!DOCTYPE html>

{% load static %}
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Unity WebGL Player | EcoMystery</title>
  <link rel="shortcut icon" href="{% static 'unity/TemplateData/favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'unity/TemplateData/style.css' %}">
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>

<body>
  <div id="unity-container" class="unity-desktop">
    <canvas id="unity-canvas"></canvas>
    <div id="unity-loading-bar">
      <div id="unity-logo"></div>
      <div id="unity-progress-bar-empty">
        <div id="unity-progress-bar-full"></div>
      </div>
    </div>
    <div id="unity-warning"> </div>
    <div id="unity-footer">
      <div id="unity-webgl-logo"></div>
      <div id="unity-fullscreen-button"></div>
      <div id="unity-build-title">EcoMystery</div>
    </div>
    <div id="end-status" style="visibility: hidden"></div>
  </div>
  
  <script src="{% static 'js/unity.js' %}"></script>
  <script>
    var loaderUrl = "{% static 'unity/Build/Build.loader.js' %}";
    var config = {
      dataUrl: "{% static 'unity/Build/Build.data' %}",
      frameworkUrl: "{% static 'unity/Build/Build.framework.js' %}",
      codeUrl: "{% static 'unity/Build/Build.wasm' %}",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "EcoDetective",
      productVersion: "1.0",
      showBanner: unityShowBanner,
    };

    var script = document.createElement("script");
    script.setAttribute("src", loaderUrl);
    script.setAttribute("type", "text/javascript");
    script.onload = () => {
    console.log("SCRIPT load");

    createUnityInstance(canvas, config, (progress) => {
      progressBarFull.style.width = 100 * progress + "%";
    }).then((unityInstance) => {
      loadingBar.style.display = "none";

      console.log("UNITY INSTANCE");

      unityInstance.SendMessage('LogicObject', 'SetSuspectSprites', String("{{spriteCodes}}"));
      unityInstance.SendMessage('LogicObject', 'SetCorrectSuspect', String("{{culprit}}"));
      unityInstance.SendMessage('LogicObject', 'SetClueDescriptions', String("{{clues}}"));
      unityInstance.SendMessage('LogicObject', 'SetSuspectDescriptions', String("{{descriptions}}"));

      fullscreenButton.onclick = () => {
        unityInstance.SetFullscreen(1);
      };
    }).catch((message) => {
      alert(message);
    });
};

document.body.appendChild(script);    
  </script>

{% endblock %}
